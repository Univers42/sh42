# ============================================================================
# Process Substitution Tests for sh42
# ============================================================================
#
# Process substitution allows a command's input or output to appear as a file.
# It creates a named pipe (FIFO) or uses /dev/fd/N to connect processes.
#
# Syntax:
#   <(command)  - Output of 'command' appears as a readable file
#   >(command)  - Input to 'command' appears as a writable file
#
# ============================================================================

# ----------------------------------------------------------------------------
# Basic Input Process Substitution: <(command)
# ----------------------------------------------------------------------------

# Example 1: Compare two command outputs with diff
diff <(ls /bin) <(ls /usr/bin)
# This compares the directory listings of /bin and /usr/bin

# Example 2: Use cat to read from process substitution
cat <(echo "Hello from process substitution")
# Expected output: Hello from process substitution

# Example 3: Multiple process substitutions
paste <(seq 1 5) <(seq 6 10)
# Expected output:
# 1	6
# 2	7
# 3	8
# 4	9
# 5	10

# Example 4: Using process substitution with grep
grep "bash" <(cat /etc/shells)
# Lists shells containing "bash"

# Example 5: Combining with pipes
cat <(echo -e "line1\nline2\nline3") | head -2
# Expected output:
# line1
# line2

# ----------------------------------------------------------------------------
# Output Process Substitution: >(command)
# ----------------------------------------------------------------------------

# Example 6: Tee with process substitution
echo "Hello World" | tee >(cat -n) >/dev/null
# The output goes to cat -n which numbers the line

# Example 7: Write to multiple destinations
echo "Log entry" | tee >(cat > /tmp/log1.txt) >(cat > /tmp/log2.txt) > /dev/null
cat /tmp/log1.txt
cat /tmp/log2.txt
# Both files should contain "Log entry"

# ----------------------------------------------------------------------------
# Practical Use Cases
# ----------------------------------------------------------------------------

# Example 8: Compare sorted files
diff <(sort file1.txt) <(sort file2.txt)
# Compare sorted versions of two files

# Example 9: Using with while read
while read line; do
    echo "Read: $line"
done < <(seq 1 3)
# Expected output:
# Read: 1
# Read: 2
# Read: 3

# Example 10: Process substitution as argument to echo
echo "File is: " <(echo test)
# Shows: File is: /dev/fd/N  (where N is the file descriptor)

# Example 11: Multiple process substitutions in one command
paste <(seq 1 3) <(seq 4 6) <(seq 7 9)
# Expected output:
# 1	4	7
# 2	5	8
# 3	6	9

# ============================================================================
# Notes:
# ============================================================================
#
# 1. Process substitution requires /dev/fd to be available (Linux/macOS)
# 2. The substituted path looks like /dev/fd/63 or similar
# 3. The file descriptor is only valid while the command is running
# 4. Process substitutions run asynchronously
#
# ============================================================================
